<div class="container">
  <div class="table-container">
    <div class="results"><%= @rules.size %> normas encontradas</div>
      <div id="data">
        <table class="table">
          <thead class="thead-dark">
            <% if @rules.size.positive? %>
              <tr>
                <th scope="col">Jurisdi√ß√£o</th>
                <th scope="col">Emissor</th>
                <th scope="col">Categoria</th>
                <th scope="col">N√∫mero</th>
                <th scope="col">Data de Publica√ß√£o</th>
                <th scope="col">Data de Edi√ß√£o</th>
                <th scope="col">Ementa</th>
                <th scope="col">Fonte</th>
                <th scope="col">Avalia√ß√£o</th>
                <th scope="col">Vig√™ncia</th>
                <th scope="col">Detalhar</th>
                <th scope="col">A√ß√£o</th>
              </tr>
            </thead>
            <tbody>
            <% @rules.each do |rule| %>
              <tr>
                <td><%= rule.jurisdiction %></td>
                <td><%= rule.issuer %></td>
                <td><%= rule.category %></td>
                <td><%= rule.number %></td>
                <td><%= rule.pub_date %></td>
                <td><%= rule.ed_date %></td>
                <td><%= rule.long_title.truncate_words(10) %></td>
                <td><%= rule.source %></td>

                <% grade_count = 0 %>
                <% rule.ratings.each {|rating| grade_count = grade_count + rating.grade if !rating.grade.nil?} %>
                <td><%= grade_count %><%= grade_count >= 0 ? " üëç" : " üëé"  %></td>

                <% validity_count = 0 %>
                <% rule.ratings.each {|rating| validity_count = validity_count + rating.validity if !rating.validity.nil?} %>
                <td><%= validity_count %><%= validity_count >= 0 ? " üëç" : " üëé"  %></td>

                <td><%= link_to "Detalhar", rule_path(rule), class: "font-weight-bold" %></td class="text-center">
                <td class="button-myrules">
                  <%= link_to "", edit_rule_path(rule), class: "fas fa-edit" %>
                  <%= link_to "", delete_rules_path(rule), class: "far fa-trash-alt", method: :delete, data: {confirm: "Voc√™ realmente deseja remover a norma?"} %>
                </td>
              </tr>
            <% end %>
            <% else %>
              <p class="title">N√£o foram encontrados resultados para essa busca</p>
            <% end %>
            </tbody>
        </table>
      </div>
    <div class="item-a">
      <button class="btn-ghost" onclick="exportDataToExcel('data')">Baixar arquivo</button>
      <%= link_to "Cadastrar nova norma", new_rule_path, class: "btn-ghost" %>
    </div>
  </div>
</div>

<script src="//code.jquery.com/jquery-3.2.1.min.js"></script>
<script src="//cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>

<script>
$(document).ready(function(){
    $('.table').DataTable({
        "language": {
              "lengthMenu": "Mostrando _MENU_ registros por p√°gina",
              "zeroRecords": "Nada encontrado",
              "info": "Mostrando p√°gina _PAGE_ de _PAGES_",
              "infoEmpty": "Nenhum registro dispon√≠vel",
              "infoFiltered": "(filtrado de _MAX_ registros no total)",
              "sSearch" : "Filtrar",
              "oPaginate": {
                      "sFirst":    "Primeira",
                      "sPrevious": "Anterior",
                      "sNext":     "Pr√≥xima",
                      "sLast":     "√öltima"
                    }
          }
      });
});
</script>

<script>
      function exportDataToExcel(data, filename = '')
       {
          var downloadurl;
          var fileType = 'application/vnd.ms-excel';
          var tableSelect = document.getElementById(data);
          var dataHTML = tableSelect.outerHTML.replace(/ /g, '%20');
          filename = filename?filename+'.xls':'user_details.xls';
          downloadurl = document.createElement("a");
          document.body.appendChild(downloadurl);
         if(navigator.msSaveOrOpenBlob)
           {
              var blob = new Blob(['\ufeff', dataHTML],
               {
                  type:  fileType
              });
             navigator.msSaveOrOpenBlob( blob, filename);
           }
        else
          {
           downloadurl.href = 'data:' + fileType + ', ' + dataHTML;
           downloadurl.download = filename;
          downloadurl.click();
       }
    }
</script>
